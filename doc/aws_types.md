..  
声明：   
本博客欢迎转发，但请保留原作者信息!   
博客地址：http://yq.aliyun.com/u/seraph  
新浪微博：@寻觅神迹

内容系本人学习、研究和总结，如有雷同，实属荣幸！   

==================
AWS是目前最主流的公有云，Amazon多年来积累的大量经验对后来者颇有借鉴意义。  
AWS在官方文档中，虽然并未说明详细的服务器硬件配置，但是文档中诸多地方可以作为推断的理由。  
只是这些可供推断的依据，散落在AWS官方文档的各处。
以下基于AWS的资料，尝试分析AWS可能的服务器配置，以及一些背后更进一步的信息。   
因为信息有限，这里不能确保分析的正确性，一家之言，仅供大家参考。也欢迎有经验/有其他信息来源的同行朋友一起探讨。

## 一些推断的基础
### CPU/内存不超分  
也就是每个VCPU对应一个超线程核，内存也是实际可用内存。但是T2类型比较特殊，是AWS所有类型实例中唯一进行超分的。  

#### 为什么其他规格是不超分的？
从AWS的以下说明可以看出来，CPU、内存是不超分的。
> CPU、内存和实例存储这类主机资源是 Amazon EC2 专用的。但 Amazon EC2 也会在实例间共享主机的另一些资源，例如网络和磁盘子系统。如果一台主机上的每个实例都试图尽可能多地使用这些共享的资源，那么每个实例都将获得该资源相等份额。然而，当某个资源未被充分利用时，实例往往可以在它可用时获取该资源的更高份额。

从其他几种类型实例所运行的业务；业务特性来说，不进行超分也是合理的。

#### T2是超分的
T2本来的定位就是CPU使用率低，偶尔高峰，成本最低的实例类型。下边是AWS推荐的场景：  
> 开发环境、搭建服务器、代码存储库、低流量网站和 Web 应用程序、微型服务、早期产品试验、小型数据库。  

从以上的定位可以看出来，T2实际上是最适合超分的实例类型。  
我们在看下T2的实际规格，可以看出来T2的规格很小，最大为2U8G。而且CPU/内存配比不固定，总共存在4种情况(1:0.5,1:1,1:2,1:4)。 另外T2是唯一引入了CPU积分制度的实例类型，进一步佐证了我们关于T2是超分的判断。
>每个 T2 实例根据实例大来以固定频率持续接收 CPU 积分。T2 实例会在其空闲时累计 CPU 积分，然后在活跃时使用 CPU 积分。

### AWS是基于XEN虚拟化技术的
这个很多公开资料可知，另外从虚拟机中使用dmesg也可以看到。不再详细说明。   
因此，考虑服务器硬件类型时，需要考虑domain0的资源占用。

### 不同的实例类型使用不同规格的服务器
这个结论很容易得出，因为没有实例的CPU规格AWS是明确说明的。另外内存、网络、存储的支持情况也各不相同。    
基本上不可能存在两种不同类型的实例在同一个太服务器上部署。  

从每种类型实例的不同规格上来看，基本上是以2倍递增的（T2除外）。  
考虑到每台服务的经济性，扣除Domain0资源占用，最好能够整分给虚拟机使用。  

### 经济性  
从经济性考虑，专用主机的硬件和普通方式实例的硬件应该采用一致的规格。   
如下，我们可以从AWS公开资料看到专用主机的硬件规格：  
截图


这里可以看到一个有趣的事情，G2服务器有2个CPU，每个20核。而[Amazon EC2实例规格](https://aws.amazon.com/cn/ec2/instance-types/?nc1=h_ls)中写了G2使用Intel Xeon E5-2670 (Sandy Bridge) CPU，从Intel资料可以看到，该CPU只有8核16个超线程。

## 分析
### 
## 结论



